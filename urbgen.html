
<!DOCTYPE html>
<html>
  <head>
    <script src="js/UrbGen.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="1300" height="700">
    </canvas>
    <script>
      //////////////////////////////////////////////////////////////////////////
      // DRAWS THE CITY BLOCKS
      //////////////////////////////////////////////////////////////////////////
      var drawBlocks = function() {
        for (var i = 0; i < blocks.length; i++) {
          for (var j = 0; j < blocks[i].edges.length; j++) {
            var startIndex = blocks[i].edges[j].start;
            var endIndex = blocks[i].edges[j].end;
            context.beginPath();
            context.moveTo(vertices[startIndex].x, vertices[startIndex].y);
            context.lineTo(vertices[endIndex].x, vertices[endIndex].y);
            //context.lineWidth = blocks[i].edges[j].width;
            context.stroke()
            context.closePath();
          }
        }
      }
      //////////////////////////////////////////////////////////////////////////
      // DRAWS THE ROADS
      //////////////////////////////////////////////////////////////////////////
      var drawRoads = function() {
        for (var i = 0; i < roadSegs.length; i++) {
          var startIndex = roadSegs[i].start;
          var endIndex = roadSegs[i].end;
          context.beginPath();
          context.moveTo(vertices[startIndex].x, vertices[startIndex].y);
          context.lineTo(vertices[endIndex].x, vertices[endIndex].y);
          context.lineWidth = roadSegs[i].width;
          context.stroke()
          context.closePath();
        }
      }
      //////////////////////////////////////////////////////////////////////////
      // DRAWS AN EDGE
      //////////////////////////////////////////////////////////////////////////
      var drawEdge = function(edge) {
        context.beginPath();
        start = edge.start;
        end = edge.end;
        context.moveTo(start.x, start.y);
        for (var i = 0; i <= 1; i += 0.05) {
          var p = edge.getPoint(i);
          context.lineTo(p.x, p.y);
        }
        context.lineTo(end.x, end.y);
        context.stroke();
        context.closePath();
      }
      //////////////////////////////////////////////////////////////////////////
      // DRAWS A QUAD
      //////////////////////////////////////////////////////////////////////////
      var drawQuad = function(quad) {
        quad.edges.forEach(drawEdge);
      }
       //////////////////////////////////////////////////////////////////////////
      // DIVIDES A QUAD RECURSIVELY
      //////////////////////////////////////////////////////////////////////////
      var divideRecur = function(quads) {
        var finished = true;
        for (var i = 0; i < quads.length; i++) {
          if (!quads[i].atomic) {
            finished = false;
          }
          if (finished) {
            return quads;
          } else {
            var newQuads = [];
            for (var i = 0; i < quads.length; i++) {
              var dividedQuads = divideQuad(quads[i]);
              newQuads.push(dividedQuads[0], dividedQuads[1]);
            }
            return divideRecur(newQuads);
          }
        }
      }
      //////////////////////////////////////////////////////////////////////////
      // TESTING
      //////////////////////////////////////////////////////////////////////////
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      context.lineWidth = 2;
      context.strokeStyle = "#000000";
      /*
      // make an absolute edge
      var edge1 = new AbsEdge(new Point(0, 0, 0), new Point(500, 100, 0));
      // make a composite edge with the same start and end
      var edge2 = makeCompositeEdge(edge1, 5);
      edge2.edges[2].start.x *= 1.1;
      edge2.edges[2].start.y *= 0.9;
      edge2.edges[3].start.x *= 0.9;
      edge2.edges[3].start.y *= 1.1;
      for (var i = 0; i < edge2.edges.length; i++) {
        drawEdge(edge2.edges[i]);
      }
      // get a point on an edge
      var point = edge2.getPoint(0.67);
      // make another edge starting at this point
      var edge3 = makeCompositeEdge(new AbsEdge(new Point(point.x, point.y, point.z), new Point(10, 500, 0)), 2);
      edge3.edges[0].end.x += 100
      for (var i = 0; i < edge3.edges.length; i++) {
        drawEdge(edge3.edges[i]);
      }
      
      
      var edge0 = new Edge(new Point(0,0,0), new Point(1300,0,0));
      var edge1 = new Edge(new Point(0,0,0), new Point(0,600,0));
      var edge2 = new Edge(new Point(0,600,0), new Point(1300,600,0));
      var edge3 = new Edge(new Point(1300,0,0), new Point(1300,600,0));
      var quad = new Quad(edge0, edge1, edge2, edge3);
      var quads = [];
      quads.push(quad);
      var newQuads = divideRecur(quads);
      newQuads.forEach(drawQuad);
      */
      
      //////////////////////////////////////////////////////////////////////////
      //////////////////////////////////////////////////////////////////////////
      //////////////////////////////////////////////////////////////////////////
      function go() {
        if (Math.random() < 0.5) {
          for (var i = 0; i < edges.length; i += 2) {
            halve(edges[i], getGridAngle(edges[i]));
          }
        } else {
          for (var i = 1; i < edges.length; i += 2) {
            halve(edges[i]);
          }
        }
        //edges.forEach(function(edge) {if (Math.random() < 0.5) {halve(edge)} else {(halve(edge+1))}});
      }
      var p0 = new Point(100,200,0);
      var p1 = new Point(1200,200,0);
      var p2 = new Point(300,500,0);
      var p3 = new Point(1200,580,0);
      var e0 = new Edge(p0, p1);
      var e1 = new Edge(e0.start, p2);
      var e2 = new Edge(p2, p3);
      var e3 = new Edge(e0.end, p3);
      e0.opposite = e2;
      e0.startConnector = e1;
      e0.endConnector = e3;
      e0.isMaster = true;
      e1.opposite = e3;
      e1.startConnector = e0;
      e1.endConnector = e2;
      edges = [e0, e1, e2, e3];
      //var e = divideEdge(e1, 2);
      for (var i = 0; i < 2; i++) {
        go();
      }
      for (var i = 0; i < edges.length; i++) {
        if (edges[i].length() > 100) {
          edges[i].start.setValues(edges[i].getPoint(Math.random() / 2))
        }
      }
      edges.forEach(drawEdge);
    </script>
  </body>
</html>
