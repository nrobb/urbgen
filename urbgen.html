
<!DOCTYPE html>
<html>
  <head>
    <script src="js/UrbGen.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="1300" height="700">
    </canvas>
    <script>
      //////////////////////////////////////////////////////////////////////////
      // DRAWS THE CITY BLOCKS
      //////////////////////////////////////////////////////////////////////////
      var drawBlocks = function() {
        for (var i = 0; i < blocks.length; i++) {
          for (var j = 0; j < blocks[i].edges.length; j++) {
            var startIndex = blocks[i].edges[j].start;
            var endIndex = blocks[i].edges[j].end;
            context.beginPath();
            context.moveTo(vertices[startIndex].x, vertices[startIndex].y);
            context.lineTo(vertices[endIndex].x, vertices[endIndex].y);
            //context.lineWidth = blocks[i].edges[j].width;
            context.stroke()
            context.closePath();
          }
        }
      }
      //////////////////////////////////////////////////////////////////////////
      // DRAWS THE ROADS
      //////////////////////////////////////////////////////////////////////////
      var drawRoads = function() {
        for (var i = 0; i < roadSegs.length; i++) {
          var startIndex = roadSegs[i].start;
          var endIndex = roadSegs[i].end;
          context.beginPath();
          context.moveTo(vertices[startIndex].x, vertices[startIndex].y);
          context.lineTo(vertices[endIndex].x, vertices[endIndex].y);
          context.lineWidth = roadSegs[i].width;
          context.stroke()
          context.closePath();
        }
      }
      //////////////////////////////////////////////////////////////////////////
      // DRAWS AN EDGE
      //////////////////////////////////////////////////////////////////////////
      var drawEdge = function(edge) {
        context.beginPath();
        start = edge.start;
        end = edge.end;
        context.moveTo(edge.points[0].x, edge.points[0].y);
        for (var i = 0; i < edge.points.length; i++) {
          var p = edge.points[i];
          context.lineTo(p.x, p.y);
        }
        context.lineTo(end.x, end.y);
        context.stroke();
        context.closePath();
      }
      //////////////////////////////////////////////////////////////////////////
      // DRAWS A QUAD
      //////////////////////////////////////////////////////////////////////////
      var drawQuad = function(quad) {
        quad.edges.forEach(drawEdge);
      }
       //////////////////////////////////////////////////////////////////////////
      // DIVIDES A QUAD RECURSIVELY
      //////////////////////////////////////////////////////////////////////////
      var divideRecur = function(quads) {
        var finished = true;
        for (var i = 0; i < quads.length; i++) {
          if (!quads[i].atomic) {
            finished = false;
          }
          if (finished) {
            return quads;
          } else {
            var newQuads = [];
            for (var i = 0; i < quads.length; i++) {
              var dividedQuads = divideQuad(quads[i]);
              newQuads.push(dividedQuads[0], dividedQuads[1]);
            }
            return divideRecur(newQuads);
          }
        }
      }
      //////////////////////////////////////////////////////////////////////////
      // TESTING
      //////////////////////////////////////////////////////////////////////////
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      context.lineWidth = 2;
      context.strokeStyle = "#000000";
      /*
      // make an absolute edge
      var edge1 = new AbsEdge(new Point(0, 0, 0), new Point(500, 100, 0));
      // make a composite edge with the same start and end
      var edge2 = makeCompositeEdge(edge1, 5);
      edge2.edges[2].start.x *= 1.1;
      edge2.edges[2].start.y *= 0.9;
      edge2.edges[3].start.x *= 0.9;
      edge2.edges[3].start.y *= 1.1;
      for (var i = 0; i < edge2.edges.length; i++) {
        drawEdge(edge2.edges[i]);
      }
      // get a point on an edge
      var point = edge2.getPoint(0.67);
      // make another edge starting at this point
      var edge3 = makeCompositeEdge(new AbsEdge(new Point(point.x, point.y, point.z), new Point(10, 500, 0)), 2);
      edge3.edges[0].end.x += 100
      for (var i = 0; i < edge3.edges.length; i++) {
        drawEdge(edge3.edges[i]);
      }
      
      
      var edge0 = new Edge(new Point(0,0,0), new Point(1300,0,0));
      var edge1 = new Edge(new Point(0,0,0), new Point(0,600,0));
      var edge2 = new Edge(new Point(0,600,0), new Point(1300,600,0));
      var edge3 = new Edge(new Point(1300,0,0), new Point(1300,600,0));
      var quad = new Quad(edge0, edge1, edge2, edge3);
      var quads = [];
      quads.push(quad);
      var newQuads = divideRecur(quads);
      newQuads.forEach(drawQuad);
      */
      
      //////////////////////////////////////////////////////////////////////////
      //////////////////////////////////////////////////////////////////////////
      //////////////////////////////////////////////////////////////////////////
      function go() {
        if (Math.random() < 0.5) {
          for (var i = 0; i < edges.length; i += 2) {
            halve(edges[i], getGridAngle(edges[i]));
          }
        } else {
          for (var i = 1; i < edges.length; i += 2) {
            halve(edges[i]);
          }
        }
        //edges.forEach(function(edge) {if (Math.random() < 0.5) {halve(edge)} else {(halve(edge+1))}});
      }
      var p0 = new Point(10,10,0);
      var p1 = new Point(600,10,0);
      var p2 = new Point(100,600,0);
      var p3 = new Point(600,600,0);
      var e0 = new Edge(p0, p1);
      var e1 = new Edge(e0.start, p2);
      var e2 = new Edge(e1.end, p3);
      var e3 = new Edge(e0.end, e2.end);
      var quad = new Quad(e0, e1, e2, e3);
      
      //// this is a function starting here
      var indices = getEdgePair(quad);
      var short = quad.edges[indices[0]];
      var long = quad.edges[indices[1]];
      var start1 = short.getPoint(0.1);
      var start2 = short.getPoint(0.9);
      var end1 = findIntersectPoint(start1, getGridAngle(short), long.points[0], long.angle())
      var end2 = findIntersectPoint(start2, getGridAngle(short), long.points[0], long.angle())
      var newEdge;
      var start;
      var end;
      if (pointOnEdge(long, end1)) {
        start = start1;
        end = end1
      } else if (pointOnEdge(long, end2)) {
        start = start2;
        end = end2
      } else {
        console.debug("neither point is on the edge")
      }
      if (indices[0] > indices[1]) {
        var temp = start;
        start = end;
        end = temp;
      }
      var newEdge = new Edge(start, end);
      

      
      
      drawEdge(newEdge);
      
      drawQuad(quad);
      /*
      var dY = Math.random();
      for (var i = 0.99; i > 0.01; i -= 0.01) {
        var p = e0.getPoint(i)
        p.y += dY;
        dY += 0.05;
        e0.points.splice(1, 0, p)
      }
      */
    </script>
  </body>
</html>
