
<!DOCTYPE html>
<html>
  <head>
    <script src="js/UrbGen.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="1300" height="700">
    </canvas>
    <script>
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS A LINE BETWEEN TWO SPECIFIED POINTS
      //////////////////////////////////////////////////////////////////////////
      function drawLine(p0, p1) {
        context.beginPath();
        context.moveTo(p0.x, p0.y);
        context.lineTo(p1.x, p1.y);
        context.stroke();
        context.closePath();
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS TOP AND LEFT EDGES OF A QUAD
      //////////////////////////////////////////////////////////////////////////
      function drawPoint(point) {
        for (var i = 2; i < 4; i++) {
          var q = point.neighbors[i];
          if (q !== undefined) {
            drawLine(point, q);
          }
        }
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS TOP AND LEFT EDGES OF A QUAD
      //////////////////////////////////////////////////////////////////////////
      function drawTopLeft(poly) {
        var point = poly.corners[0];
        for (var i = 2; i < 4; i++) {
          var q = point.neighbors[i];
          drawLine(point, q);
        }
      };
      function drawPoly(poly) {
        var p0 = poly.corners[0];
        var p1 = poly.corners[1];
        var p2 = poly.corners[2];
        var p3 = poly.corners[3];
        drawLine(p0, p1);
        drawLine(p0, p2);
        drawLine(p1, p3);
        drawLine(p2, p3);
        //console.debug(p0);
      }
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // SETS POINTS' NEIGHBORS
      //////////////////////////////////////////////////////////////////////////
      function initNeighbors() {
        topLeft.neighbors[3] = topRight;
        topLeft.neighbors[2] = bottomLeft;
        topRight.neighbors[1] = topLeft;
        topRight.neighbors[2] = bottomRight;
        bottomLeft.neighbors[0] = topLeft;
        bottomLeft.neighbors[3] = bottomRight;
        bottomRight.neighbors[0] = topRight;
        bottomRight.neighbors[1] = bottomLeft;
      }
      //////////////////////////////////////////////////////////////////////////
      // INITIALIZE CANVAS AND CONTEXT
      //////////////////////////////////////////////////////////////////////////
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      context.lineWidth = 0.5;
      context.strokeStyle = "#000000";
      //////////////////////////////////////////////////////////////////////////
      // TESTING
      //////////////////////////////////////////////////////////////////////////
      // Set up the points
      var topLeft = new URBGEN.Point(100, 40, 0);
      var topRight = new URBGEN.Point(1050, 5, 0);
      var bottomLeft = new URBGEN.Point(40, 300, 0);
      var bottomRight = new URBGEN.Point(900, 400, 0);
      // Set each point's neighbors correctly
      var poly = new URBGEN.Poly(topLeft, topRight, bottomLeft, bottomRight);
      var polys = [poly];
      initNeighbors();
      var points = [topLeft, topRight, bottomLeft, bottomRight];
      /************************************************************************/
function pathTest(p0, p1, direction) {
  for (var i = 0; i < 200; i++) {
    if (p0.neighbors[direction] === p1) return true;
    if (p0.neighbors[direction] !== 0) {
      p0 = p0.neighbors[direction];
    }
  }
  return false;
}
function polyTest(poly) {
  return pathTest(poly.corners[0], poly.corners[1], 3) &&
  pathTest(poly.corners[0], poly.corners[2], 2) &&
  pathTest(poly.corners[1], poly.corners[0], 1) &&
  pathTest(poly.corners[1], poly.corners[3], 2) &&
  pathTest(poly.corners[2], poly.corners[0], 0) &&
  pathTest(poly.corners[2], poly.corners[3], 3) &&
  pathTest(poly.corners[3], poly.corners[1], 0) &&
  pathTest(poly.corners[3], poly.corners[2], 1);
}
      /************************************************************************/
var testVertical = function(polygon) {
  var builder = new URBGEN.Builder.VerticalBuilder();
  var data = {
    origin: URBGEN.Util.linearInterpolate(polygon.corners[0], polygon.corners[1], Math.random() * 0.2 + 0.4),
    angle: Math.PI / 2,
    edges: [new URBGEN.Edge([polygon.corners[0], polygon.corners[1]], 3), new URBGEN.Edge([polygon.corners[2], polygon.corners[3]], 3)],
    originalPoints: [polygon.corners[0], polygon.corners[1], polygon.corners[2], polygon.corners[3]]
  };
  return builder.buildPolys(builder.getNewPoints(data));
}
var testHorizontal = function(polygon) {
  var builder = new URBGEN.Builder.HorizontalBuilder();
  var data = {
    origin: URBGEN.Util.linearInterpolate(polygon.corners[0], polygon.corners[2], Math.random() * 0.2 + 0.4),
    angle: Math.PI,
    edges: [new URBGEN.Edge([polygon.corners[0], polygon.corners[2]], 2), new URBGEN.Edge([polygon.corners[1], polygon.corners[3]], 2)],
    originalPoints: [polygon.corners[0], polygon.corners[1], polygon.corners[2], polygon.corners[3]]
  };
  return builder.buildPolys(builder.getNewPoints(data));
}
var run = function(origPolys, r) {
  var ret = [];
  for (var i = 0; i< origPolys.length; i++) {
    if (r === 1) {
      ret = ret.concat(testHorizontal(origPolys[i]));
    } else {
      ret = ret.concat(testVertical(origPolys[i]));
    }
  }
  return ret;
}
    for (var i = 0; i < 10; i++) {
      var rand = Math.floor(Math.random() * 2);
      polys = run(polys, rand);
    }
    polys.forEach(drawPoly);
    </script>
  </body>
</html>
