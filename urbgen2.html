
<!DOCTYPE html>
<html>
  <head>
    <script src="js/UrbGen.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="1300" height="700">
    </canvas>
    <script>
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS A LINE BETWEEN TWO SPECIFIED POINTS
      //////////////////////////////////////////////////////////////////////////
      function drawLine(p0, p1) {
        context.beginPath();
        context.moveTo(p0.x, p0.y);
        context.lineTo(p1.x, p1.y);
        context.stroke();
        context.closePath();
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS TOP AND LEFT EDGES OF A QUAD
      //////////////////////////////////////////////////////////////////////////
      function drawPoint(point) {
        for (var i = 2; i < 4; i++) {
          var q = point.neighbors[i];
          if (q !== undefined) {
            drawLine(point, q);
          }
        }
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS TOP AND LEFT EDGES OF A QUAD
      //////////////////////////////////////////////////////////////////////////
      function drawTopLeft(poly) {
        var point = poly.corners[0];
        for (var i = 2; i < 4; i++) {
          var q = point.neighbors[i];
          if (q !== undefined) {
            drawLine(point, q);
          }
        }
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // SETS POINTS' NEIGHBORS
      //////////////////////////////////////////////////////////////////////////
      function initNeighbors() {
        topLeft.neighbors[3] = topRight;
        topLeft.neighbors[2] = bottomLeft;
        topRight.neighbors[1] = topLeft;
        topRight.neighbors[2] = bottomRight;
        bottomLeft.neighbors[0] = topLeft;
        bottomLeft.neighbors[3] = bottomRight;
        bottomRight.neighbors[0] = topRight;
        bottomRight.neighbors[1] = bottomLeft;
      }
      //////////////////////////////////////////////////////////////////////////
      // INITIALIZE CANVAS AND CONTEXT
      //////////////////////////////////////////////////////////////////////////
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      context.lineWidth = 0.5;
      context.strokeStyle = "#000000";
      //////////////////////////////////////////////////////////////////////////
      // TESTING
      //////////////////////////////////////////////////////////////////////////
      // Set up the points
      var topLeft = new URBGEN.Point(10, 20, 0);
      var topRight = new URBGEN.Point(1050, 25, 0);
      var bottomLeft = new URBGEN.Point(20, 600, 0);
      var bottomRight = new URBGEN.Point(1200, 500, 0);
      // Set each point's neighbors correctly
      initNeighbors();
      var points = [topLeft, topRight, bottomLeft, bottomRight];
      var poly = new URBGEN.Poly(topLeft, topRight, bottomLeft, bottomRight);
      var polys = [poly];
      var minArea = 220000;
      var control = new URBGEN.Control();
      /************************************************************************/
      
var test = function(polys) {
  var ret = [];
  for (var i = 0; i < polys.length; i++) {
    control.prepareBuilder(polys[i]);
    control.builder.setNewPoints();
    var newPolys = control.builder.buildPolys();
    for (var j = 0; j < newPolys.length; j++){
      ret.push(newPolys[j]);
    }
  }
  return ret;
};
      /************************************************************************/
      for (var i = 0; i < 10; i++) {
        polys = test(polys);
      }
      console.debug(polys.length);
      polys.forEach(drawTopLeft);
    </script>
  </body>
</html>
