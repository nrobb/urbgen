
<!DOCTYPE html>
<html>
  <head>
    <script src="js/UrbGen.js"></script>
  </head>
  <body>
    <canvas id="canvas" width="1300" height="700">
    </canvas>
    <script>
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS A LINE BETWEEN TWO SPECIFIED POINTS
      //////////////////////////////////////////////////////////////////////////
      function drawLine(p0, p1) {
        context.beginPath();
        context.moveTo(p0.x, p0.y);
        context.lineTo(p1.x, p1.y);
        context.stroke();
        context.closePath();
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS TOP AND LEFT EDGES OF A QUAD
      //////////////////////////////////////////////////////////////////////////
      function drawPoint(point) {
        for (var i = 2; i < 4; i++) {
          var q = point.neighbors[i];
          if (q !== undefined) {
            drawLine(point, q);
          }
        }
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // DRAWS TOP AND LEFT EDGES OF A QUAD
      //////////////////////////////////////////////////////////////////////////
      function drawTopLeft(poly) {
        var point = poly.corners[0];
        for (var i = 2; i < 4; i++) {
          var q = point.neighbors[i];
          if (q !== undefined) {
            drawLine(point, q);
          }
        }
      };
      //////////////////////////////////////////////////////////////////////////
      // FUNCTION
      // SETS POINTS' NEIGHBORS
      //////////////////////////////////////////////////////////////////////////
      function initNeighbors() {
        p0.neighbors[3] = p1;
        p0.neighbors[2] = p2;
        p1.neighbors[1] = p0;
        p1.neighbors[2] = p3;
        p2.neighbors[0] = p0;
        p2.neighbors[3] = p3;
        p3.neighbors[0] = p1;
        p3.neighbors[1] = p2;
      }
      //////////////////////////////////////////////////////////////////////////
      // INITIALIZE CANVAS AND CONTEXT
      //////////////////////////////////////////////////////////////////////////
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      context.lineWidth = 0.5;
      context.strokeStyle = "#000000";
      //////////////////////////////////////////////////////////////////////////
      // TESTING
      //////////////////////////////////////////////////////////////////////////
      // Set up the points
      var p0 = new URBGEN.Point(10, 20, 0);
      var p1 = new URBGEN.Point(1050, 25, 0);
      var p2 = new URBGEN.Point(20, 500, 0);
      var p3 = new URBGEN.Point(1200, 605, 0);
      // Set each point's neighbors correctly
      initNeighbors();
      var points = [p0, p1, p2, p3];
      var poly = new URBGEN.Poly(p0, p1, p2, p3);
      /************************************************************************/
      
      var p = URBGEN.Util.linearInterpolate(p3, p2, 0.9);
      console.debug(URBGEN.Util.insertPoint(p, p2, p3));
      var quadTest = URBGEN.Util.testForQuad(poly);
      if (quadTest.isQuad === false) {
        
/**
 * Given a poly that is not a quad, returns the first segment end point of the
 * most segmented edge, and a point on the opposite edge. The latter point is
 * either the first segment end (if the opposite edge has segments) or else a
 * point determined by an appropriate method.
 */
var getConnectingPoints = function(quadTestResult) {
  var edgePair;
  var direction;
  // Find the Edge Pair containing the most segmented edge and the direction
  if (quadTestResult.horizontal.getMostSegmented().points.length
    >= quadTestResult.vertical.getMostSegmented().points.length) {
      edgePair = quadTestResult.horizontal;
      direction = 3;
  } else {
    edgePair = quadTestResult.vertical;
    direction = 2;
  }
  // Get the edges
  var edge0 = edgePair.getMostSegmented();
  var edge1 = edgePair.getOpposite(edge0);
  // Find the start and end points
  var start = edge0.points[1];
  var end;
  if (edge1.points.length > 2) {
    end = edge1.points[1];
  } else {
    //TODO change this
    end = URBGEN.Util.linearInterpolate(edge1.points[0], edge1.points[1], 0.5);
  }
  // If the start and end points need swapped, swap them
  if (edgePair.e0 === edge1) {
    var temp = end;
    end = start;
    start = temp;
  }
  // Return the points
  var points = [start, end];
  return points;
}


        var quadTest = URBGEN.Util.testForQuad(poly);
        var points = getConnectingPoints(quadTest);
        var polys = URBGEN.Util.dividePoly(poly, points, 3);
        polys.forEach(drawTopLeft);
      }
      /************************************************************************/
    </script>
  </body>
</html>
