<!DOCTYPE html>
  <head>
    <script src="js/UrbGen.js"></script>
    <script src="js/UrbGenDemo.js"></script>
    <script src="js/dat.gui.min.js"></script>
  </head>
  <body>
  <canvas id="canvas" width="1300" height="700"></canvas>
    <script>
      var gen = new URBGEN.Generator();
      
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      var blockColor = "#E1E1E1";
      var buildingColor = "#BEADAD";
      context.strokeStyle = blockColor;
      context.lineWidth = 2.5;
      gen.initRandom();
      gen.generate();
      var nodes = gen.city.roads;
      console.debug(nodes);
      for (var i = 0; i < nodes.length; i++) {
        var p0 = nodes[i];
        var p1 = p0.neighbors[3];
        var p2 = p0.neighbors[2];
        context.moveTo(p0.x, p0.y);
        context.lineTo(p1.x, p1.y);
        context.stroke();
        
        context.moveTo(p0.x, p0.y);
        context.lineTo(p2.x, p2.y);
        context.stroke();
        
      }
      var plots = gen.city.getPlots();
      for (var i = 0; i < plots.length; i++) {
        var poly = plots[i].poly;
        drawPoly(poly, buildingColor);
      }
      /*
      window.onLoad = function() {
        var gui = new dat.GUI();
        gui.width = 300;
        gui.add(gen, "regularity1", 0.5, 0.8).listen();
        gui.add(gen, "regularity2", 0.5, 0.8).listen();
        gui.add(gen, "blockSize", 10000, 30000).listen();
        gui.add(gen, "buildingSize", 2000, 3000).listen();
        gui.add(gen, "width", 200, window.innerWidth * 0.95).listen();
        gui.add(gen, "depth", 200, window.innerHeight * 0.95).listen();
        gui.add(gen, "minEdgeLength", 40, 50).listen();
        gui.add(gen, "gridThreshold", 0, 1).listen();
        gui.add(gen, "throughRoadStagger", 0, 50).listen();
        gui.add(this, "update").listen();
        gui.add(this, "random").listen();
        this.update();
      };
    
      window.random = function() {
        context.clearRect(0, 0, 1300, 700);
        gen.initRandom();
        gen.generate();
        for (var j = 0; j < gen.cityPolys.length; j++) {
          var poly = gen.cityPolys[j];
          drawPoly(poly, window.blockColor);
        }
        for (var i = 0; i < gen.buildings.length; i++) {
          var poly = gen.buildings[i];
          drawPoly(poly, window.buildingColor);
        }
      }
      
      window.update = function() {
        context.clearRect(0, 0, 1300, 700);
        gen.init();
        gen.generate();
        for (var j = 0; j < gen.cityPolys.length; j++) {
          var poly = gen.cityPolys[j];
          drawPoly(poly, window.blockColor);
        }
        for (var i = 0; i < gen.buildings.length; i++) {
          var poly = gen.buildings[i];
          drawPoly(poly, window.buildingColor);
        }
      };
      */
      function drawPoly(poly, c) {
        var p0 = poly.corners[0];
        var p1 = poly.corners[1];
        var p2 = poly.corners[2];
        var p3 = poly.corners[3];
        context.beginPath();
        context.moveTo(p0.x, p0.y);
        context.lineTo(p1.x, p1.y);
        context.lineTo(p3.x, p3.y);
        context.lineTo(p2.x, p2.y);
        context.closePath();
        context.fillStyle = c;
        context.fill();
      };
      
      //window.onLoad();
      
    </script>
  </body>
</html>